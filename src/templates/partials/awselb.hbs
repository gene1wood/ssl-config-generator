{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Generated {{output.date}}, {{{output.link}}}",
    "Parameters": {
        "SSLCertificateId": {
            "Description": "The ARN of the SSL certificate to use",
            "Type": "String",
            "AllowedPattern": "^arn:[^:]*:[^:]*:[^:]*:[^:]*:.*$",
            "ConstraintDescription": "SSL Certificate ID must be a valid ARN. http://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html#genref-arns"
        }
    },
    "Resources": {
        "ExampleELB": {
            "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
            "Properties": {
                "Listeners": [
                    {
                        "LoadBalancerPort": "443",
                        "InstancePort": "80",
                        "PolicyNames": [
                            "Mozilla-{{form.config}}-2015-03"
                        ],
                        "SSLCertificateId": {
                            "Ref": "SSLCertificateId"
                        },
                        "Protocol": "HTTPS"
                    }
                ],
                "AvailabilityZones": {
                    "Fn::GetAZs": ""
                },
                "Policies": [
                    {
                        "PolicyName": "Mozilla-{{form.config}}-2015-03",
                        "PolicyType": "SSLNegotiationPolicyType",
                        "Attributes": [
{{#each output.protocols}}
                            {
                                "Name": "Protocol-{{this}}",
                                "Value": true
                            },
{{/each}}
                            {
                                "Name": "Server-Defined-Cipher-Order",
                                "Value": {{#if output.serverPreferredOrder}}true{{else}}false{{/if}}
                            },
{{#each output.ciphers}}
                            {
                                "Name": "{{this}}",
                                "Value": true
                            }{{#unless @last}},{{/unless}}
{{/each}}
                        ]
                    }
                ]
            }
        }
    },
    "Outputs": {
        "ELBDNSName": {
            "Description": "DNS entry point to the stack (all ELBs)",
            "Value": {
                "Fn::GetAtt": [
                    "ExampleELB",
                    "DNSName"
                ]
            }
        }
    }
}
